gensbi.models.flux1
===================

.. py:module:: gensbi.models.flux1

.. autoapi-nested-parse::

   

















   ..
       !! processed by numpydoc !!


Submodules
----------

.. toctree::
   :maxdepth: 1

   /api/gensbi/models/flux1/layers/index
   /api/gensbi/models/flux1/loss/index
   /api/gensbi/models/flux1/math/index
   /api/gensbi/models/flux1/model/index


Classes
-------

.. autoapisummary::

   gensbi.models.flux1.Flux
   gensbi.models.flux1.FluxCFMLoss
   gensbi.models.flux1.FluxParams


Package Contents
----------------

.. py:class:: Flux(params)

   Bases: :py:obj:`flax.nnx.Module`


   
   Transformer model for flow matching on sequences.
















   ..
       !! processed by numpydoc !!

   .. py:method:: __call__(obs, obs_ids, cond, cond_ids, timesteps, conditioned = True, guidance = None)


   .. py:attribute:: cond_in


   .. py:attribute:: condition_embedding


   .. py:attribute:: condition_null


   .. py:attribute:: double_blocks


   .. py:attribute:: final_layer


   .. py:attribute:: hidden_size


   .. py:attribute:: in_channels


   .. py:attribute:: num_heads


   .. py:attribute:: obs_in


   .. py:attribute:: out_channels


   .. py:attribute:: params


   .. py:attribute:: pe_embedder


   .. py:attribute:: qkv_features


   .. py:attribute:: single_blocks


   .. py:attribute:: time_in


   .. py:attribute:: use_rope


   .. py:attribute:: vector_in


.. py:class:: FluxCFMLoss(path, reduction='mean', cfg_scale=None)

   Bases: :py:obj:`gensbi.flow_matching.loss.ContinuousFMLoss`


   
   FluxCFMLoss is a class that computes the continuous flow matching loss for the Flux model.

   :param path: Probability path (x-prediction training).
   :param reduction: Specify the reduction to apply to the output ``'none'`` | ``'mean'`` | ``'sum'``. ``'none'``: no reduction is applied to the output, ``'mean'``: the output is reduced by mean over sequence elements, ``'sum'``: the output is reduced by sum over sequence elements. Defaults to 'mean'.
   :type reduction: str, optional















   ..
       !! processed by numpydoc !!

   .. py:method:: __call__(vf, batch, cond, obs_ids, cond_ids)

      
      Evaluates the continuous flow matching loss.

      :param vf: The vector field model to evaluate.
      :type vf: callable
      :param batch: A tuple containing the input data (x_0, x_1, t).
      :type batch: tuple
      :param cond: The conditioning data.
      :type cond: jnp.ndarray
      :param obs_ids: The observation IDs.
      :type obs_ids: jnp.ndarray
      :param cond_ids: The conditioning IDs.
      :type cond_ids: jnp.ndarray

      :returns: The computed loss.
      :rtype: jnp.ndarray















      ..
          !! processed by numpydoc !!


   .. py:attribute:: cfg_scale
      :value: None



.. py:class:: FluxParams

   
   Parameters for the Flux model.

   :param in_channels: Number of input channels.
   :type in_channels: int
   :param vec_in_dim: Dimension of the vector input, if applicable.
   :type vec_in_dim: Union[int, None]
   :param context_in_dim: Dimension of the context input.
   :type context_in_dim: int
   :param mlp_ratio: Ratio for the MLP layers.
   :type mlp_ratio: float
   :param num_heads: Number of attention heads.
   :type num_heads: int
   :param depth: Number of double stream blocks.
   :type depth: int
   :param depth_single_blocks: Number of single stream blocks.
   :type depth_single_blocks: int
   :param axes_dim: Dimensions of the axes for positional encoding.
   :type axes_dim: list[int]
   :param qkv_bias: Whether to use bias in QKV layers.
   :type qkv_bias: bool
   :param rngs: Random number generators for initialization.
   :type rngs: nnx.Rngs
   :param obs_dim: Observation dimension.
   :type obs_dim: int
   :param cond_dim: Condition dimension.
   :type cond_dim: int
   :param use_rope: Whether to use Rotary Position Embedding (RoPE).
   :type use_rope: bool
   :param theta: Scaling factor for positional encoding.
   :type theta: int
   :param guidance_embed: Whether to use guidance embedding.
   :type guidance_embed: bool
   :param qkv_multiplier: Multiplier for QKV features.
   :type qkv_multiplier: int
   :param param_dtype: Data type for model parameters.
   :type param_dtype: DTypeLike















   ..
       !! processed by numpydoc !!

   .. py:method:: __post_init__()


   .. py:attribute:: axes_dim
      :type:  list[int]


   .. py:attribute:: cond_dim
      :type:  int


   .. py:attribute:: context_in_dim
      :type:  int


   .. py:attribute:: depth
      :type:  int


   .. py:attribute:: depth_single_blocks
      :type:  int


   .. py:attribute:: guidance_embed
      :type:  bool
      :value: False



   .. py:attribute:: in_channels
      :type:  int


   .. py:attribute:: mlp_ratio
      :type:  float


   .. py:attribute:: num_heads
      :type:  int


   .. py:attribute:: obs_dim
      :type:  int


   .. py:attribute:: param_dtype
      :type:  jax.typing.DTypeLike


   .. py:attribute:: qkv_bias
      :type:  bool


   .. py:attribute:: qkv_multiplier
      :type:  int
      :value: 1



   .. py:attribute:: rngs
      :type:  flax.nnx.Rngs


   .. py:attribute:: theta
      :type:  int
      :value: 10000



   .. py:attribute:: use_rope
      :type:  bool
      :value: True



   .. py:attribute:: vec_in_dim
      :type:  Union[int, None]


